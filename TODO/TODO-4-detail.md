# TODO-4: å®‰å…¨ãƒãƒªã‚·ãƒ¼ãƒ»æ‹’å¦æ–¹é‡ç­–å®š

## ğŸ“‹ æ¦‚è¦
- **ç›®çš„**: AIè¦‹ç©ã‚Šã‚·ã‚¹ãƒ†ãƒ ã®å®‰å…¨æ€§ã‚’ç¢ºä¿ã™ã‚‹ãŸã‚ã€å®‰å…¨ãƒãƒªã‚·ãƒ¼ã¨æ‹’å¦æ–¹é‡ã‚’ç­–å®šã—ã€ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«çµ„ã¿è¾¼ã‚€
- **æœŸé–“**: Day 7
- **å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜
- **ä¾å­˜é–¢ä¿‚**: TODO-2ï¼ˆGuardrailså®Ÿè£…ï¼‰ã€TODO-3ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯å¯¾å¿œï¼‰

## ğŸ¯ é”æˆåŸºæº–
- [ ] å®‰å…¨ãƒãƒªã‚·ãƒ¼æ–‡æ›¸ä½œæˆå®Œäº†ï¼ˆja/enï¼‰
- [ ] æ‹’å¦æ–¹é‡æ–‡æ›¸ä½œæˆå®Œäº†ï¼ˆja/enï¼‰
- [ ] ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¸ã®å®‰å…¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³çµ„ã¿è¾¼ã¿å®Œäº†
- [ ] SafetyServiceå®Ÿè£…å®Œäº†
- [ ] æ‹’å¦ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Ÿè£…ãƒ»ãƒ†ã‚¹ãƒˆå®Œäº†
- [ ] å¤šè¨€èªå¯¾å¿œï¼ˆja/enï¼‰
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†

---

## ğŸ“ è¨ˆç”»

### 1. å®‰å…¨ãƒãƒªã‚·ãƒ¼ã®ç­–å®š

#### 1.1 å¯¾è±¡ç¯„å›²

AIè¦‹ç©ã‚Šã‚·ã‚¹ãƒ†ãƒ ã«ãŠã„ã¦ã€ä»¥ä¸‹ã®å®‰å…¨æ€§ã‚’ç¢ºä¿ã™ã‚‹ï¼š

1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®å®‰å…¨æ€§**
   - æœ‰å®³ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æ¤œå‡ºãƒ»æ‹’å¦
   - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒã®é˜²æ­¢
   - PIIæƒ…å ±ã®ä¿è­·

2. **LLMå‡ºåŠ›ã®å®‰å…¨æ€§**
   - ä¸é©åˆ‡ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æ¤œå‡ºãƒ»ä¿®æ­£
   - èª¤æƒ…å ±ã®é˜²æ­¢
   - PIIæƒ…å ±ã®æ¼æ´©é˜²æ­¢

3. **ã‚·ã‚¹ãƒ†ãƒ ã®å®‰å…¨æ€§**
   - ã‚µãƒ¼ãƒ“ã‚¹æ‹’å¦æ”»æ’ƒã®é˜²æ­¢
   - ã‚³ã‚¹ãƒˆç®¡ç†
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

#### 1.2 ãƒãƒªã‚·ãƒ¼æ–‡æ›¸æ§‹æˆ

**docs/safety/SAFETY_POLICY.md** (æ—¥æœ¬èªç‰ˆ)

```markdown
# AIè¦‹ç©ã‚Šã‚·ã‚¹ãƒ†ãƒ  å®‰å…¨ãƒãƒªã‚·ãƒ¼

## 1. æ¦‚è¦

ã“ã®ãƒãƒªã‚·ãƒ¼ã¯ã€AIè¦‹ç©ã‚Šã‚·ã‚¹ãƒ†ãƒ ã®å®‰å…¨ã§è²¬ä»»ã‚ã‚‹é‹ç”¨ã‚’ç¢ºä¿ã™ã‚‹ãŸã‚ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã§ã™ã€‚

## 2. åŸºæœ¬åŸå‰‡

### 2.1 èª å®Ÿæ€§
- æ­£ç¢ºã§æ ¹æ‹ ã®ã‚ã‚‹è¦‹ç©ã‚Šã‚’æä¾›
- ä¸ç¢ºå®Ÿæ€§ãŒã‚ã‚‹å ´åˆã¯æ˜ç¤º
- èª¤è§£ã‚’æ‹›ãè¡¨ç¾ã‚’é¿ã‘ã‚‹

### 2.2 é€æ˜æ€§
- AI ã«ã‚ˆã‚‹ç”Ÿæˆã§ã‚ã‚‹æ—¨ã‚’æ˜ç¤º
- è¦‹ç©ã‚Šæ ¹æ‹ ã‚’æä¾›
- åˆ¶é™äº‹é …ã‚’èª¬æ˜

### 2.3 ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·
- PIIæƒ…å ±ã‚’å–å¾—ãƒ»ä¿å­˜ãƒ»åˆ©ç”¨ã—ãªã„
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã¯è¦‹ç©ã‚Šç›®çš„ã®ã¿ã«ä½¿ç”¨
- é©åˆ‡ãªæœŸé–“å¾Œã«ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤

### 2.4 å®‰å…¨æ€§
- æœ‰å®³ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç”Ÿæˆãƒ»å—ã‘å…¥ã‚Œãªã„
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«å¾“ã†
- ç¶™ç¶šçš„ãªç›£è¦–ã¨æ”¹å–„

## 3. ç¦æ­¢äº‹é …

ã‚·ã‚¹ãƒ†ãƒ ã¯ä»¥ä¸‹ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç”Ÿæˆãƒ»å—ã‘å…¥ã‚Œã¾ã›ã‚“ï¼š

### 3.1 æœ‰å®³ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„
- é•æ³•ã€æš´åŠ›çš„ã€è„…è¿«çš„ãªå†…å®¹
- å·®åˆ¥çš„ã€ä¸­å‚·çš„ãªå†…å®¹
- æ€§çš„ã«éœ²éª¨ãªå†…å®¹
- ãƒãƒ©ã‚¹ãƒ¡ãƒ³ãƒˆçš„ãªå†…å®¹

### 3.2 ä¸æ­£ãªæ“ä½œ
- ä¸å½“ã«é«˜é¡ã¾ãŸã¯ä½é¡ãªè¦‹ç©ã‚Š
- æ ¹æ‹ ã®ãªã„é‡‘é¡æ“ä½œ
- æ„å›³çš„ãªèª¤æƒ…å ±

### 3.3 ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¾µå®³
- å€‹äººæƒ…å ±ï¼ˆåå‰ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€é›»è©±ç•ªå·ç­‰ï¼‰ã®è¦æ±‚
- æ©Ÿå¯†æƒ…å ±ã®æ¼æ´©
- ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãƒ»ç›£è¦–

## 4. æ‹’å¦åŸºæº–

ã‚·ã‚¹ãƒ†ãƒ ã¯ä»¥ä¸‹ã®å ´åˆã€å‡¦ç†ã‚’è‡ªå‹•çš„ã«æ‹’å¦ã—ã¾ã™ï¼š

### 4.1 å…¥åŠ›æ‹’å¦
- æ¯’æ€§ã‚¹ã‚³ã‚¢ 0.8ä»¥ä¸Šã®è¨€èª
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º
- å…¥åŠ›é•· 10,000æ–‡å­—è¶…é
- ä¸æ­£ãªãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™è¶…éï¼ˆ10MBï¼‰

### 4.2 å‡ºåŠ›æ‹’å¦
- PIIæƒ…å ±ã‚’å«ã‚€å‡ºåŠ›
- æ¯’æ€§ã‚¹ã‚³ã‚¢ 0.8ä»¥ä¸Šã®å‡ºåŠ›
- ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼å¤±æ•—
- ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«é•åï¼ˆå·¥æ•°ç¯„å›²å¤–ç­‰ï¼‰

## 5. ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ‰‹é †

### 5.1 æ‹’å¦æ™‚ã®å¯¾å¿œ
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ˜ç¢ºãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã™
2. æ‹’å¦ç†ç”±ã‚’ãƒ­ã‚°ã«è¨˜éŒ²
3. ç¹°ã‚Šè¿”ã—é•åã®å ´åˆã€ç®¡ç†è€…ã«é€šçŸ¥

### 5.2 ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- æŠ€è¡“çš„è©³ç´°ã¯å«ã‚ãªã„
- æ”¹å–„æ–¹æ³•ã‚’æç¤º
- ã‚µãƒãƒ¼ãƒˆé€£çµ¡å…ˆã‚’æ¡ˆå†…

## 6. ç›£è¦–ã¨ãƒ¬ãƒ“ãƒ¥ãƒ¼

### 6.1 ç¶™ç¶šçš„ç›£è¦–
- æ‹’å¦ã•ã‚ŒãŸå…¥åŠ›/å‡ºåŠ›ã®å®šæœŸãƒ¬ãƒ“ãƒ¥ãƒ¼
- èª¤æ¤œçŸ¥ã®åˆ†æã¨æ”¹å–„
- ãƒãƒªã‚·ãƒ¼ã®å®šæœŸæ›´æ–°ï¼ˆå››åŠæœŸã”ã¨ï¼‰

### 6.2 ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œ
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç™ºç”Ÿæ™‚ã®æ‰‹é †
- å½±éŸ¿ç¯„å›²ã®è©•ä¾¡
- å†ç™ºé˜²æ­¢ç­–ã®ç­–å®š

## 7. ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹

- GDPRã€å€‹äººæƒ…å ±ä¿è­·æ³•ç­‰ã®ãƒ‡ãƒ¼ã‚¿ä¿è­·è¦åˆ¶ã«æº–æ‹ 
- OWASP LLM Top 10ã«åŸºã¥ãã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–
- å®šæœŸçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»

---

**ç™ºåŠ¹æ—¥**: 2025-10-18
**æ”¹è¨‚å±¥æ­´**:
- 2025-10-18: åˆç‰ˆä½œæˆ
```

### 2. ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¸ã®çµ„ã¿è¾¼ã¿

#### 2.1 å®‰å…¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã®å®šç¾©

**app/prompts/safety_guidelines.py** (æ–°è¦ä½œæˆ)

```python
from app.core.i18n import t

def get_safety_guidelines() -> str:
    """å®‰å…¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’å–å¾—ï¼ˆå¤šè¨€èªå¯¾å¿œï¼‰"""
    return t('prompts.safety_guidelines')
```

**ç¿»è¨³ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°** (app/locales/ja.json)

```json
{
  "prompts": {
    "safety_guidelines": "\n## å®‰å…¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³\n\nä»¥ä¸‹ã®åŸå‰‡ã«å¾“ã£ã¦ãã ã•ã„ï¼š\n1. æ­£ç¢ºã§èª å®Ÿãªè¦‹ç©ã‚Šã‚’æä¾›ã™ã‚‹\n2. ä¸ç¢ºå®Ÿæ€§ãŒã‚ã‚‹å ´åˆã¯æ˜ç¤ºã™ã‚‹\n3. ä¸é©åˆ‡ã¾ãŸã¯é•æ³•ãªè¦æ±‚ã«ã¯å¿œã˜ãªã„\n4. å€‹äººæƒ…å ±ã‚’å«ã¾ãªã„\n5. å°‚é–€çš„ã§ä¸­ç«‹çš„ãªãƒˆãƒ¼ãƒ³ã‚’ç¶­æŒã™ã‚‹\n\nç¦æ­¢äº‹é …ï¼š\n- æ ¹æ‹ ã®ãªã„é‡‘é¡ã®æç¤º\n- å€‹äººæƒ…å ±ã®è¦æ±‚\n- å·®åˆ¥çš„ã¾ãŸã¯æ”»æ’ƒçš„ãªè¨€è‘‰ã®ä½¿ç”¨\n"
  }
}
```

#### 2.2 ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ›´æ–°

**app/prompts/question_prompts.py** (å¤‰æ›´)

```python
from app.prompts.safety_guidelines import get_safety_guidelines

def get_system_prompt() -> str:
    """è³ªå•ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆå®‰å…¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ä»˜ãï¼‰"""
    base = t('prompts.question_system')
    language_instruction = t('prompts.language_instruction')
    safety = get_safety_guidelines()

    return f"{base}\n\n{safety}\n\n{language_instruction}"
```

**app/prompts/estimate_prompts.py** (åŒæ§˜ã«å¤‰æ›´)

**app/prompts/chat_prompts.py** (åŒæ§˜ã«å¤‰æ›´)

### 3. SafetyServiceå®Ÿè£…

#### 3.1 SafetyService (app/services/safety_service.py)

```python
from typing import Tuple
import logging
from fastapi import HTTPException
from app.services.guardrails_service import GuardrailsService
from app.services.security_service import SecurityService
from app.core.i18n import t

logger = logging.getLogger(__name__)

class SafetyService:
    """å®‰å…¨æ€§ãƒã‚§ãƒƒã‚¯ã¨æ‹’å¦ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°"""

    def __init__(self):
        self.guardrails = GuardrailsService()
        self.security = SecurityService()

    def check_input_safety(self, content: str, content_type: str = "input") -> Tuple[bool, str]:
        """å…¥åŠ›ã®å®‰å…¨æ€§ãƒã‚§ãƒƒã‚¯

        Returns:
            (is_safe: bool, message: str)
        """
        try:
            # 1. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
            self.security.check_prompt_injection(content)

            # 2. Guardrailsãƒã‚§ãƒƒã‚¯ï¼ˆæœ‰å®³è¨€èªã€PIIã€é•·ã•ï¼‰
            self.guardrails.validate_input(content)

            return True, "OK"

        except ValueError as e:
            error_msg = str(e)
            logger.warning(f"Safety check failed ({content_type}): {error_msg}")
            return False, error_msg

    def check_output_safety(self, content: str) -> Tuple[bool, str]:
        """å‡ºåŠ›ã®å®‰å…¨æ€§ãƒã‚§ãƒƒã‚¯"""
        try:
            self.guardrails.validate_output(content)
            return True, "OK"
        except Exception as e:
            error_msg = str(e)
            logger.warning(f"Output safety check failed: {error_msg}")
            return False, error_msg

    def handle_rejection(self, reason: str, content_type: str = "input") -> None:
        """æ‹’å¦æ™‚ã®å‡¦ç†ï¼ˆä¾‹å¤–ã‚’æŠ•ã’ã‚‹ï¼‰"""
        # ãƒ­ã‚°è¨˜éŒ²
        logger.warning(f"Request rejected ({content_type}): {reason}")

        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        user_message = self._get_user_friendly_message(reason)

        raise HTTPException(
            status_code=400,
            detail=user_message
        )

    def _get_user_friendly_message(self, reason: str) -> str:
        """ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ"""
        if "prompt_injection" in reason.lower():
            return t('messages.safety_prompt_injection')
        elif "toxic" in reason.lower():
            return t('messages.safety_toxic_content')
        elif "pii" in reason.lower():
            return t('messages.safety_pii_detected')
        elif "length" in reason.lower():
            return t('messages.safety_length_exceeded')
        else:
            return t('messages.safety_general_rejection')
```

#### 3.2 APIçµ±åˆ (app/api/v1/tasks.py)

```python
from app.services.safety_service import SafetyService

safety_service = SafetyService()

@router.post("/tasks")
async def create_task(...):
    # ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶ã®å®‰å…¨æ€§ãƒã‚§ãƒƒã‚¯
    if system_requirements:
        is_safe, message = safety_service.check_input_safety(
            system_requirements,
            content_type="system_requirements"
        )
        if not is_safe:
            safety_service.handle_rejection(message, "system_requirements")
    # ... æ—¢å­˜å‡¦ç† ...

@router.post("/tasks/{task_id}/answers")
async def submit_answers(...):
    # å„å›ç­”ã®å®‰å…¨æ€§ãƒã‚§ãƒƒã‚¯
    for key, value in answers.items():
        is_safe, message = safety_service.check_input_safety(value, f"answer_{key}")
        if not is_safe:
            safety_service.handle_rejection(message, f"answer_{key}")
    # ... æ—¢å­˜å‡¦ç† ...
```

### 4. å¤šè¨€èªå¯¾å¿œ

**ç¿»è¨³ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°**

**app/locales/ja.json**
```json
{
  "messages": {
    "safety_prompt_injection": "ä¸æ­£ãªå…¥åŠ›ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚å…¥åŠ›å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚",
    "safety_toxic_content": "ä¸é©åˆ‡ãªå†…å®¹ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚é©åˆ‡ãªè¡¨ç¾ã«ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚",
    "safety_pii_detected": "å€‹äººæƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚å€‹äººæƒ…å ±ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚",
    "safety_length_exceeded": "å…¥åŠ›ãŒé•·ã™ãã¾ã™ã€‚10,000æ–‡å­—ä»¥å†…ã«ã—ã¦ãã ã•ã„ã€‚",
    "safety_general_rejection": "å…¥åŠ›ãŒå®‰å…¨åŸºæº–ã‚’æº€ãŸã—ã¦ã„ã¾ã›ã‚“ã€‚å†…å®¹ã‚’è¦‹ç›´ã—ã¦ãã ã•ã„ã€‚"
  }
}
```

**app/locales/en.json** (åŒæ§˜ã«è‹±èªç¿»è¨³è¿½åŠ )

### 5. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **Python logging**: ãƒ­ã‚°è¨˜éŒ²
- **FastAPI HTTPException**: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- **Markdown**: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¨˜è¿°

### 6. å½±éŸ¿ç¯„å›²

**æ–°è¦ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«**
- `docs/safety/SAFETY_POLICY.md` (ja)
- `docs/safety/SAFETY_POLICY_EN.md` (en)
- `app/prompts/safety_guidelines.py`
- `app/services/safety_service.py`

**å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«**
- `app/prompts/question_prompts.py`
- `app/prompts/estimate_prompts.py`
- `app/prompts/chat_prompts.py`
- `app/api/v1/tasks.py`
- `app/locales/ja.json`
- `app/locales/en.json`

**ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«è¿½åŠ **
- `backend/tests/unit/test_safety_service.py`
- `backend/tests/integration/test_safety_integration.py`

### 7. ãƒªã‚¹ã‚¯ã¨å¯¾ç­–

#### ãƒªã‚¹ã‚¯1: éåº¦ãªæ‹’å¦ï¼ˆèª¤æ¤œçŸ¥ï¼‰
- **å¯¾ç­–**: ã—ãã„å€¤èª¿æ•´ã€ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆæ©Ÿèƒ½ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åé›†

#### ãƒªã‚¹ã‚¯2: ãƒãƒªã‚·ãƒ¼ã®å½¢éª¸åŒ–
- **å¯¾ç­–**: å®šæœŸãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆå››åŠæœŸã”ã¨ï¼‰ã€å®Ÿéš›ã®æ‹’å¦ã‚±ãƒ¼ã‚¹åˆ†æ

#### ãƒªã‚¹ã‚¯3: å¤šè¨€èªå¯¾å¿œã®ä¸æ•´åˆ
- **å¯¾ç­–**: ç¿»è¨³ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€ä¸¡è¨€èªã§ã®ãƒ†ã‚¹ãƒˆå®Ÿæ–½

### 8. ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

**Day 7**:
- å®‰å…¨ãƒãƒªã‚·ãƒ¼æ–‡æ›¸ä½œæˆï¼ˆja/enï¼‰
- å®‰å…¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³å®šç¾©ãƒ»ç¿»è¨³è¿½åŠ 
- ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ›´æ–°
- SafetyServiceå®Ÿè£…
- APIçµ±åˆ
- ãƒ†ã‚¹ãƒˆå®Ÿè£…
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ¬ãƒ“ãƒ¥ãƒ¼

---

## ğŸ”§ å®Ÿæ–½å†…å®¹ï¼ˆå®Ÿç¸¾ï¼‰

### Day 7: 2025-10-20
#### å®Ÿæ–½ä½œæ¥­
- [x] å®‰å…¨ãƒãƒªã‚·ãƒ¼æ–‡æ›¸ä½œæˆï¼ˆæ—¥æœ¬èªãƒ»è‹±èªï¼‰
- [x] ç¿»è¨³ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°ï¼ˆja.jsonã€en.jsonï¼‰
- [x] SafetyServiceå®Ÿè£…
- [x] ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«å®‰å…¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³çµ„ã¿è¾¼ã¿
- [x] APIçµ±åˆï¼ˆtasks.pyï¼‰
- [x] ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆãƒ¦ãƒ‹ãƒƒãƒˆãƒ»çµ±åˆï¼‰
- [x] å‹•ä½œç¢ºèªï¼ˆpytest + å®ŸAPIï¼‰

#### ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«
**æ–°è¦ä½œæˆ**:
- `docs/safety/SAFETY_POLICY.md` - æ—¥æœ¬èªå®‰å…¨ãƒãƒªã‚·ãƒ¼æ–‡æ›¸
- `docs/safety/SAFETY_POLICY_EN.md` - è‹±èªå®‰å…¨ãƒãƒªã‚·ãƒ¼æ–‡æ›¸
- `app/prompts/safety_guidelines.py` - å®‰å…¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³é–¢æ•°
- `app/services/safety_service.py` - SafetyServiceå®Ÿè£…
- `backend/tests/unit/test_safety_service.py` - ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆ17ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼‰
- `backend/tests/integration/test_safety_integration.py` - çµ±åˆãƒ†ã‚¹ãƒˆ

**å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«**:
- `app/locales/ja.json` - å®‰å…¨é–¢é€£ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ ï¼ˆsafety_guidelinesã€safety_*ï¼‰
- `app/locales/en.json` - å®‰å…¨é–¢é€£ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ ï¼ˆè‹±èªç‰ˆï¼‰
- `app/prompts/question_prompts.py` - å®‰å…¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³çµ±åˆ
- `app/prompts/estimate_prompts.py` - å®‰å…¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³çµ±åˆ
- `app/prompts/chat_prompts.py` - å®‰å…¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³çµ±åˆ
- `app/api/v1/tasks.py` - SafetyServiceçµ±åˆï¼ˆcreate_taskã€submit_answersï¼‰

#### ç¢ºèªãƒ»ãƒ†ã‚¹ãƒˆ
- [x] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ: **17/17 passed** (SafetyService ã‚«ãƒãƒ¬ãƒƒã‚¸ 92%)
- [x] ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ¤œå‡ºå‹•ä½œç¢ºèª
- [x] é•·ã•åˆ¶é™ãƒã‚§ãƒƒã‚¯å‹•ä½œç¢ºèª
- [x] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç¢ºèª
- [x] ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¸ã®å®‰å…¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³çµ±åˆç¢ºèª
- [x] å¤šè¨€èªå¯¾å¿œç¢ºèªï¼ˆja/enï¼‰

#### èª²é¡Œãƒ»æ°—ã¥ã
**èª²é¡Œ**:
- systemdã‚µãƒ¼ãƒ“ã‚¹è¨­å®šã«å•é¡ŒãŒã‚ã‚Šã€æ‰‹å‹•èµ·å‹•ã§å¯¾å¿œ
- Guardrails AIãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä¸€éƒ¨æ©Ÿèƒ½ãŒåˆ©ç”¨ä¸å¯ï¼ˆToxicLanguageï¼‰

**æ°—ã¥ã**:
- SecurityServiceã¨GuardrailsServiceã®çµ±åˆã«ã‚ˆã‚Šã€å¤šå±¤é˜²å¾¡ãŒå®Ÿç¾
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆã«ã‚ˆã‚Šã€UXå‘ä¸Š
- ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¸ã®å®‰å…¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³çµ„ã¿è¾¼ã¿ã«ã‚ˆã‚Šã€LLMå‡ºåŠ›ã®å®‰å…¨æ€§å‘ä¸Š
- ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸92%ã«ã‚ˆã‚Šã€é«˜å“è³ªãªå®Ÿè£…ã‚’é”æˆ

---

## ğŸ“Š å®Ÿç¸¾

### é”æˆã—ãŸæˆæœ
1. **å®‰å…¨ãƒãƒªã‚·ãƒ¼æ–‡æ›¸**: æ—¥æœ¬èªãƒ»è‹±èªã®2è¨€èªã§åŒ…æ‹¬çš„ãªãƒãƒªã‚·ãƒ¼ã‚’ç­–å®š
2. **SafetyServiceå®Ÿè£…**: Guardrailsã¨Securityã®çµ±åˆãƒ©ãƒƒãƒ‘ãƒ¼ã‚’å®Ÿè£…
3. **APIçµ±åˆ**: å…¥åŠ›æ™‚ã®è‡ªå‹•å®‰å…¨ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè£…
4. **ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆçµ±åˆ**: ã™ã¹ã¦ã®LLMå‘¼ã³å‡ºã—ã«å®‰å…¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’é©ç”¨
5. **ãƒ†ã‚¹ãƒˆå®Ÿè£…**: 17å€‹ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆãƒ¦ãƒ‹ãƒƒãƒˆãƒ»çµ±åˆï¼‰ã‚’å®Ÿè£…
6. **å¤šè¨€èªå¯¾å¿œ**: å®‰å…¨é–¢é€£ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å®Œå…¨å¤šè¨€èªå¯¾å¿œï¼ˆja/enï¼‰

### æ‹’å¦ã‚±ãƒ¼ã‚¹ã®åˆ†æ
å®Ÿè£…ã—ãŸæ‹’å¦ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼š
1. **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³**: "Ignore previous instructions" ç­‰ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œå‡º
2. **é•·ã•åˆ¶é™**: 10,000æ–‡å­—è¶…éã®å…¥åŠ›ã‚’æ‹’å¦
3. **PIIæ¤œå‡º**: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€é›»è©±ç•ªå·ç­‰ã®å€‹äººæƒ…å ±ã‚’æ¤œå‡ºï¼ˆGuardrailsæ©Ÿèƒ½ï¼‰
4. **æœ‰å®³è¨€èª**: ä¸é©åˆ‡ãªè¨€èªè¡¨ç¾ã‚’æ¤œå‡ºï¼ˆGuardrailsæ©Ÿèƒ½ï¼‰

### å­¦ã³
1. **å¤šå±¤é˜²å¾¡ã®é‡è¦æ€§**: SecurityServiceï¼ˆãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ï¼‰+ Guardrailsï¼ˆAIæ¤œè¨¼ï¼‰ã®çµ„ã¿åˆã‚ã›ãŒåŠ¹æœçš„
2. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“**: æŠ€è¡“çš„è©³ç´°ã‚’éš è”½ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé‡è¦
3. **ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ**: LLMã«æ˜ç¤ºçš„ãªå®‰å…¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’ä¸ãˆã‚‹ã“ã¨ã§å‡ºåŠ›å“è³ªå‘ä¸Š
4. **ãƒ†ã‚¹ãƒˆé§†å‹•**: é«˜ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼ˆ92%ï¼‰ã®ãƒ†ã‚¹ãƒˆã«ã‚ˆã‚Šã€å®‰å…¨æ€§ã‚’ä¿è¨¼

---

## âœ… å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [x] å®‰å…¨ãƒãƒªã‚·ãƒ¼æ–‡æ›¸å®Œæˆï¼ˆja/enï¼‰
- [x] ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«å®‰å…¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³çµ„ã¿è¾¼ã¿
- [x] SafetyServiceå®Ÿè£…å®Œäº†
- [x] æ‹’å¦ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å‹•ä½œç¢ºèª
- [x] å¤šè¨€èªå¯¾å¿œç¢ºèªï¼ˆja/enï¼‰
- [x] ãƒ†ã‚¹ãƒˆå®Ÿè£…å®Œäº†
- [x] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†

## ğŸ“š å‚è€ƒè³‡æ–™
- todo.md (334-428è¡Œç›®): TODO-4è©³ç´°
- `/home/ec2-user/hirashimallc/02_pj-ReadyTensor/output/doc/35_ai-that-doesnt-harm-principles-of-safety-and-alignment-aaidc-week9-lesson4.md`
- OpenAI Safety Best Practices: https://platform.openai.com/docs/guides/safety-best-practices

---

**ä½œæˆæ—¥**: 2025-10-18
**æœ€çµ‚æ›´æ–°**: 2025-10-20
**æ‹…å½“**: Claude Code
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: å®Œäº† âœ…
