# ai-estimator2

## Overview
AI-powered project estimation system with an intelligent web interface. This production-ready system uses OpenAI to automatically generate accurate project estimates based on deliverables and system requirements. It features a 2-step UX flow for estimate adjustments, where users can request cost changes (e.g., "reduce by 300,000 yen") and receive AI-generated proposal cards with detailed change breakdowns.

### Evolution from Module 2

This system evolved from **DeliverableEstimatePro3**, a CLI-based estimation tool developed in Module 2 of the ReadyTensor Agentic AI Developer Certification program. The transformation from a command-line prototype to a production-ready web application represents a comprehensive journey through enterprise-grade system development:

- **Module 2 (DeliverableEstimatePro3)**: CLI tool for basic AI-powered project estimation
- **Module 3 (ai-estimator2)**: Full-stack web application with production features including comprehensive testing (87 tests, 100% pass rate), security guardrails, operational resilience, monitoring systems, and complete documentation

### Key Features

1. **Multiple Input Methods**
   - Excel file upload
   - CSV file upload
   - Web form input (tab-based UI)

2. **AI-Powered Estimation**
   - Automatic question generation based on deliverables
   - OpenAI-powered estimate calculation
   - Detailed reasoning and breakdown for each estimate

3. **Interactive Estimate Adjustment**
   - Natural language adjustment requests (e.g., "reduce by 300,000 yen")
   - AI-generated proposal cards (3 options)
   - One-click application of selected proposals
   - Real-time estimate updates

4. **Visual Results**
   - Bar chart visualization
   - Accordion-style detail view
   - Work breakdown display
   - Excel download

5. **Enterprise-Grade Resilience** üÜï
   - Retry with exponential backoff for API failures
   - Circuit breaker pattern for fault tolerance
   - Loop detection to prevent infinite loops
   - Resource limiting to prevent DoS attacks

6. **Monitoring & Observability** üÜï
   - Structured logging with request tracing
   - Real-time metrics collection (API calls, OpenAI usage, errors)
   - Performance monitoring (response times, P95 latency)
   - Admin dashboard endpoints

7. **Cost Management & Security** üÜï
   - OpenAI API cost tracking with daily/monthly limits
   - Automatic shutdown on cost overrun ($10/day, $200/month)
   - Rate limiting (100 requests/hour) for DoS prevention
   - Emergency shutdown procedures

8. **Data Privacy & GDPR Compliance** üÜï
   - Privacy policy and data handling guidelines
   - Automatic data deletion after retention period (30 days)
   - GDPR-compliant data deletion API
   - PII detection and masking in logs

### Technology Stack

- **Backend**: FastAPI, Python 3.11, SQLAlchemy 2.0, SQLite3
- **AI**: OpenAI API
- **Frontend**: Vanilla JavaScript (embedded static UI)
- **File Processing**: openpyxl, pandas
- **Testing**: pytest, pytest-asyncio, pytest-cov (87 tests, 100% pass rate)

## Installation

### 1. Clone the repository

```bash
git clone https://github.com/daishir0/ai-estimator2.git
cd ai-estimator2
```

### 2. Set up Python environment

```bash
# Activate your Python 3.11+ environment
# Example with conda:
# source /path/to/conda/bin/activate
# conda activate your-python-env

# Navigate to backend directory
cd backend
```

### 3. Install dependencies

```bash
pip install -r requirements.txt
```

### 4. Configure environment variables

```bash
cp .env.sample .env
```

Edit `.env` file and set your OpenAI API key:

```bash
# OpenAI API Configuration
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_MODEL=gpt-4o-mini

# Database
DATABASE_URL=sqlite:///./app.db

# Server Configuration
CORS_ORIGINS=http://localhost:8000,https://estimator.path-finder.jp
API_V1_STR=/api/v1

# File Upload
UPLOAD_DIR=./uploads
MAX_UPLOAD_SIZE_MB=10

# Pricing
UNIT_PRICE_PER_DAY=40000
DAILY_UNIT_COST_JPY=40000
DAILY_UNIT_COST_USD=500

# Language Setting
LANGUAGE=ja  # or 'en' for English

# Cost Management
DAILY_COST_LIMIT=10.0      # Daily OpenAI API cost limit in USD
MONTHLY_COST_LIMIT=200.0   # Monthly OpenAI API cost limit in USD

# Rate Limiting
RATE_LIMIT_MAX_REQUESTS=100      # Max requests per window
RATE_LIMIT_WINDOW_SECONDS=3600   # Rate limit window (1 hour)

# Resilience Settings
OPENAI_TIMEOUT=30                    # OpenAI API timeout in seconds
OPENAI_MAX_RETRIES=3                 # Maximum retry attempts
OPENAI_RETRY_INITIAL_DELAY=1.0       # Initial retry delay in seconds
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5  # Failures before opening circuit
MAX_CONCURRENT_ESTIMATES=5           # Max concurrent estimate operations

# Logging
LOG_LEVEL=INFO        # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_FILE=            # Log file path (empty = console only)
MASK_PII=false       # Enable PII masking in logs

# Privacy Settings
DATA_RETENTION_DAYS=30        # Task data retention period in days
AUTO_CLEANUP_ENABLED=true     # Enable automatic data cleanup
PRIVACY_POLICY_VERSION=1.0    # Privacy policy version
```

### 5. Initialize database

The SQLite database will be created automatically on first startup. No additional setup required.

### 6. Start the server

```bash
# Development mode
uvicorn app.main:app --reload --host 127.0.0.1 --port 8000

# Production mode (using systemd)
sudo systemctl start estimator.service
```

### 7. Access the application

- Web UI: http://localhost:8000/ui
- API Documentation: http://localhost:8000/docs
- Production URL: https://estimator.path-finder.jp/

## Usage

### Basic Workflow

1. **Upload Deliverables**
   - Choose input method (Excel/CSV/Web form)
   - Upload file or enter deliverables manually
   - Optionally add system requirements

2. **Answer AI Questions**
   - System generates 3 relevant questions
   - Answer questions to refine estimates
   - Submit answers to proceed

3. **Review Estimates**
   - View detailed estimates with reasoning
   - Check work breakdown (requirements, design, implementation, testing, documentation)
   - Review total cost with tax

4. **Adjust Estimates (Optional)**
   - Type adjustment request: "„ÅÇ„Å®30‰∏áÂÜÜ„Åª„Å©ÂÆâ„Åè„Åô„ÇãÊ°à„ÇíÊïô„Åà„Å¶"
   - Review 3 AI-generated proposal cards
   - Click "„Åì„ÅÆÊ°à„ÇíÈÅ©Áî®„Åô„Çã" to apply selected proposal
   - Download Excel file with final estimates

### API Endpoints

#### Core Estimation Endpoints
- `POST /api/v1/tasks` - Create new estimation task
- `GET /api/v1/tasks/{task_id}/questions` - Get AI-generated questions
- `POST /api/v1/tasks/{task_id}/answers` - Submit answers and generate estimates
- `GET /api/v1/tasks/{task_id}/result` - Get estimation results
- `POST /api/v1/tasks/{task_id}/chat` - Adjust estimates with AI proposals
- `POST /api/v1/tasks/{task_id}/apply` - Apply adjusted estimates
- `GET /api/v1/tasks/{task_id}/download` - Download Excel file
- `DELETE /api/v1/tasks/{task_id}` - Delete task data (GDPR compliance) üÜï

#### Monitoring & Admin Endpoints üÜï
- `GET /api/v1/metrics` - Get system metrics (API calls, performance, errors)
- `GET /api/v1/admin/costs` - Get OpenAI API cost summary
- `GET /api/v1/admin/rate-limits` - Get rate limiting status
- `GET /api/v1/admin/metrics` - Get comprehensive system metrics
- `POST /api/v1/admin/reset-rate-limit/{client_id}` - Reset rate limit for client

#### Utility Endpoints
- `GET /api/v1/sample-input` - Download sample Excel file
- `GET /api/v1/sample-input-csv` - Download sample CSV file
- `GET /api/v1/translations` - Get UI translations (i18n support)

### Sample Input Files

- Sample Excel: http://localhost:8000/api/v1/sample-input
- Sample CSV: http://localhost:8000/api/v1/sample-input-csv

## Notes

- OpenAI API key is required for AI-powered features
- Default unit price is 40,000 yen per person-day (configurable in .env)
- Maximum upload file size is 10MB (configurable)
- Excel files must have columns: ÊàêÊûúÁâ©ÂêçÁß∞, Ë™¨Êòé
- CSV files must be UTF-8 encoded
- Proposal cache is shared across all instances using class variables
- The system uses gpt-4o-mini for cost-effective AI operations
- Adjustment amounts are calculated by comparing actual estimate changes, not relying on AI's target_amount_change

## Documentation

Comprehensive documentation is available in the `docs/` directory:

### For Users and Operators

- **[Project Overview](docs/PROJECT.md)** - System overview, architecture diagrams, and getting started guide
- **[Deployment Guide](docs/deployment/DEPLOYMENT_EN.md)** - Complete deployment instructions for production environment
- **[Operations Runbook](docs/operations/RUNBOOK_EN.md)** - Daily operations, monitoring, maintenance procedures
- **[Troubleshooting Guide](docs/operations/TROUBLESHOOTING_EN.md)** - Common issues and solutions, log checking methods
- **[Emergency Shutdown Procedure](docs/operations/EMERGENCY_SHUTDOWN.en.md)** üÜï - Emergency response for cost overruns and security incidents
- **[Monitoring Plan](docs/monitoring/MONITORING_PLAN_EN.md)** üÜï - Comprehensive monitoring strategy and alert configuration

### For Developers

- **[Developer Guide](docs/development/DEVELOPER_GUIDE_EN.md)** - Development environment setup, coding standards, testing
- **[API Reference](docs/development/API_REFERENCE_EN.md)** - Complete REST API documentation with examples
- **[Architecture Documentation](docs/architecture/ARCHITECTURE_EN.md)** - System architecture, data models, sequence diagrams

### Security, Privacy & Compliance

- **[Security Checklist](docs/security/SECURITY_CHECKLIST_EN.md)** - Security best practices and validation
- **[Safety Policy](docs/safety/SAFETY_POLICY_EN.md)** - LLM usage policy and data handling guidelines
- **[Privacy Policy](docs/privacy/PRIVACY_POLICY.en.md)** üÜï - Data collection, usage, and retention policies
- **[GDPR Checklist](docs/privacy/GDPR_CHECKLIST.en.md)** üÜï - GDPR compliance verification and requirements

### Japanese Documentation

All documents are also available in Japanese (Êó•Êú¨Ë™ûÁâà):

- [„Éó„É≠„Ç∏„Çß„ÇØ„ÉàÊ¶ÇË¶Å](docs/PROJECT.md) (Bilingual)
- [„Éá„Éó„É≠„Ç§„É°„É≥„Éà„Ç¨„Ç§„Éâ](docs/deployment/DEPLOYMENT.md)
- [ÈÅãÁî®ÊâãÈ†ÜÊõ∏](docs/operations/RUNBOOK.md)
- [„Éà„É©„Éñ„É´„Ç∑„É•„Éº„ÉÜ„Ç£„É≥„Ç∞„Ç¨„Ç§„Éâ](docs/operations/TROUBLESHOOTING.md)
- [Á∑äÊÄ•ÂÅúÊ≠¢ÊâãÈ†ÜÊõ∏](docs/operations/EMERGENCY_SHUTDOWN.ja.md) üÜï
- [Áõ£Ë¶ñË®àÁîª](docs/monitoring/MONITORING_PLAN.md) üÜï
- [ÈñãÁô∫ËÄÖ„Ç¨„Ç§„Éâ](docs/development/DEVELOPER_GUIDE.md)
- [API „É™„Éï„Ç°„É¨„É≥„Çπ](docs/development/API_REFERENCE.md)
- [„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£„Éâ„Ç≠„É•„É°„É≥„Éà](docs/architecture/ARCHITECTURE.md)
- [„Éó„É©„Ç§„Éê„Ç∑„Éº„Éù„É™„Ç∑„Éº](docs/privacy/PRIVACY_POLICY.ja.md) üÜï
- [GDPR„ÉÅ„Çß„ÉÉ„ÇØ„É™„Çπ„Éà](docs/privacy/GDPR_CHECKLIST.ja.md) üÜï

## License
This project is licensed under the MIT License - see the LICENSE file for details.

---

# ai-estimator2

## Ê¶ÇË¶Å
AI„ÇíÊ¥ªÁî®„Åó„Åü„Éó„É≠„Ç∏„Çß„ÇØ„ÉàË¶ãÁ©ç„Çä„Ç∑„Çπ„ÉÜ„É†„Åß„Åô„ÄÇÊú¨Áï™Áí∞Â¢ÉÂØæÂøú„ÅÆ„Åì„ÅÆ„Ç∑„Çπ„ÉÜ„É†„ÅØOpenAI„Çí‰ΩøÁî®„Åó„Å¶ÊàêÊûúÁâ©„Å®„Ç∑„Çπ„ÉÜ„É†Ë¶Å‰ª∂„Åã„ÇâËá™ÂãïÁöÑ„Å´Ê≠£Á¢∫„Å™„Éó„É≠„Ç∏„Çß„ÇØ„ÉàË¶ãÁ©ç„Çä„ÇíÁîüÊàê„Åó„Åæ„Åô„ÄÇË¶ãÁ©ç„ÇäË™øÊï¥„ÅÆ2„Çπ„ÉÜ„ÉÉ„ÉóUX„Éï„É≠„Éº„ÇíÊê≠Ëºâ„Åó„ÄÅ„Äå30‰∏áÂÜÜÂÆâ„Åè„Åó„Å¶„Äç„ÅÆ„Çà„ÅÜ„Å™„É™„ÇØ„Ç®„Çπ„Éà„Å´ÂØæ„Åó„Å¶AI„ÅåË©≥Á¥∞„Å™Â§âÊõ¥ÂÜÖË®≥„ÇíÂê´„ÇÄÊèêÊ°à„Ç´„Éº„Éâ„Çí3„Å§ÁîüÊàê„Åó„Åæ„Åô„ÄÇ

### Module 2„Åã„Çâ„ÅÆÈÄ≤Âåñ

Êú¨„Ç∑„Çπ„ÉÜ„É†„ÅØReadyTensor Agentic AI Developer Certification Program„ÅÆModule 2„ÅßÈñãÁô∫„Åó„Åü**DeliverableEstimatePro3**ÔºàCLI„Éô„Éº„Çπ„ÅÆË¶ãÁ©ç„Çä„ÉÑ„Éº„É´Ôºâ„ÇíÈÄ≤Âåñ„Åï„Åõ„Åü„ÇÇ„ÅÆ„Åß„Åô„ÄÇ„Ç≥„Éû„É≥„Éâ„É©„Ç§„É≥„ÅÆ„Éó„É≠„Éà„Çø„Ç§„Éó„Åã„ÇâÊú¨Áï™Áí∞Â¢ÉÂØæÂøú„ÅÆWeb„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Å∏„ÅÆÂ§âÈù©„ÅØ„ÄÅ„Ç®„É≥„Çø„Éº„Éó„É©„Ç§„Ç∫„Ç∞„É¨„Éº„Éâ„ÅÆ„Ç∑„Çπ„ÉÜ„É†ÈñãÁô∫„Å´„Åä„Åë„ÇãÂåÖÊã¨ÁöÑ„Å™ÊóÖË∑Ø„ÇíË°®„Åó„Å¶„ÅÑ„Åæ„ÅôÔºö

- **Module 2ÔºàDeliverableEstimatePro3Ôºâ**: Âü∫Êú¨ÁöÑ„Å™AIÈßÜÂãï„Éó„É≠„Ç∏„Çß„ÇØ„ÉàË¶ãÁ©ç„ÇäCLI„ÉÑ„Éº„É´
- **Module 3Ôºàai-estimator2Ôºâ**: Êú¨Áï™Ê©üËÉΩ„ÇíÂÇô„Åà„Åü„Éï„É´„Çπ„Çø„ÉÉ„ÇØWeb„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ÔºàÂåÖÊã¨ÁöÑ„Å™„ÉÜ„Çπ„ÉàÔºà87„ÉÜ„Çπ„Éà„ÄÅ100%ÂêàÊ†ºÁéáÔºâ„ÄÅ„Çª„Ç≠„É•„É™„ÉÜ„Ç£„Ç¨„Éº„Éâ„É¨„Éº„É´„ÄÅÈÅãÁî®„É¨„Ç∏„É™„Ç®„É≥„Çπ„ÄÅÁõ£Ë¶ñ„Ç∑„Çπ„ÉÜ„É†„ÄÅÂÆåÂÖ®„Å™„Éâ„Ç≠„É•„É°„É≥„ÉàÔºâ

### ‰∏ªË¶ÅÊ©üËÉΩ

1. **Ë§áÊï∞„ÅÆÂÖ•ÂäõÊñπÂºè**
   - Excel„Éï„Ç°„Ç§„É´„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ
   - CSV„Éï„Ç°„Ç§„É´„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ
   - Web„Éï„Ç©„Éº„É†ÂÖ•ÂäõÔºà„Çø„Éñ„Éô„Éº„ÇπUIÔºâ

2. **AIËá™ÂãïË¶ãÁ©ç„Çä**
   - ÊàêÊûúÁâ©„Å´Âü∫„Å•„ÅèËá™ÂãïË≥™ÂïèÁîüÊàê
   - OpenAI„Å´„Çà„ÇãË¶ãÁ©ç„ÇäË®àÁÆó
   - ÂêÑË¶ãÁ©ç„Çä„ÅÆË©≥Á¥∞„Å™Ê†πÊã†„Å®ÂÜÖË®≥Ë°®Á§∫

3. **„Ç§„É≥„Çø„É©„ÇØ„ÉÜ„Ç£„Éñ„Å™Ë¶ãÁ©ç„ÇäË™øÊï¥**
   - Ëá™ÁÑ∂Ë®ÄË™û„Åß„ÅÆË™øÊï¥„É™„ÇØ„Ç®„Çπ„ÉàÔºà‰æãÔºö„Äå30‰∏áÂÜÜÂÆâ„Åè„Åó„Å¶„ÄçÔºâ
   - AI„Å´„Çà„ÇãÊèêÊ°à„Ç´„Éº„ÉâÁîüÊàêÔºà3Ê°àÔºâ
   - „ÉØ„É≥„ÇØ„É™„ÉÉ„ÇØ„ÅßÊèêÊ°à„ÇíÈÅ©Áî®
   - „É™„Ç¢„É´„Çø„Ç§„É†Ë¶ãÁ©ç„ÇäÊõ¥Êñ∞

4. **Ë¶ñË¶öÁöÑ„Å™ÁµêÊûúË°®Á§∫**
   - Ê£í„Ç∞„É©„Éï„Å´„Çà„ÇãÂèØË¶ñÂåñ
   - „Ç¢„Ç≥„Éº„Éá„Ç£„Ç™„É≥ÂΩ¢Âºè„ÅÆË©≥Á¥∞Ë°®Á§∫
   - Â∑•Êï∞ÂÜÖË®≥„ÅÆË°®Á§∫
   - Excel„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ

5. **„Ç®„É≥„Çø„Éº„Éó„É©„Ç§„Ç∫„Ç∞„É¨„Éº„Éâ„ÅÆ„É¨„Ç∏„É™„Ç®„É≥„Çπ** üÜï
   - APIÈöúÂÆ≥ÊôÇ„ÅÆ„Ç®„ÇØ„Çπ„Éù„Éç„É≥„Ç∑„É£„É´„Éê„ÉÉ„ÇØ„Ç™„Éï„É™„Éà„É©„Ç§
   - „Éï„Ç©„Éº„É´„Éà„Éà„É¨„É©„É≥„Çπ„ÅÆ„Åü„ÇÅ„ÅÆ„Çµ„Éº„Ç≠„ÉÉ„Éà„Éñ„É¨„Éº„Ç´„Éº„Éë„Çø„Éº„É≥
   - ÁÑ°Èôê„É´„Éº„ÉóÈò≤Ê≠¢„ÅÆ„Åü„ÇÅ„ÅÆ„É´„Éº„ÉóÊ§úÂá∫
   - DoSÊîªÊíÉÈò≤Ê≠¢„ÅÆ„Åü„ÇÅ„ÅÆ„É™„ÇΩ„Éº„ÇπÂà∂Èôê

6. **Áõ£Ë¶ñ„ÉªÂèØË¶≥Ê∏¨ÊÄß** üÜï
   - „É™„ÇØ„Ç®„Çπ„Éà„Éà„É¨„Éº„Ç∑„É≥„Ç∞‰ªò„ÅçÊßãÈÄ†Âåñ„É≠„Ç∞
   - „É™„Ç¢„É´„Çø„Ç§„É†„É°„Éà„É™„ÇØ„ÇπÂèéÈõÜÔºàAPIÂëº„Å≥Âá∫„Åó„ÄÅOpenAI‰ΩøÁî®Áä∂Ê≥Å„ÄÅ„Ç®„É©„ÉºÔºâ
   - „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÁõ£Ë¶ñÔºà„É¨„Çπ„Éù„É≥„Çπ„Çø„Ç§„É†„ÄÅP95„É¨„Ç§„ÉÜ„É≥„Ç∑Ôºâ
   - ÁÆ°ÁêÜËÄÖ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Ç®„É≥„Éâ„Éù„Ç§„É≥„Éà

7. **„Ç≥„Çπ„ÉàÁÆ°ÁêÜ„Éª„Çª„Ç≠„É•„É™„ÉÜ„Ç£** üÜï
   - OpenAI API„Ç≥„Çπ„ÉàËøΩË∑°ÔºàÊó•Ê¨°„ÉªÊúàÊ¨°‰∏äÈôê‰ªò„ÅçÔºâ
   - „Ç≥„Çπ„ÉàË∂ÖÈÅéÊôÇ„ÅÆËá™ÂãïÂÅúÊ≠¢Ôºà$10/Êó•„ÄÅ$200/ÊúàÔºâ
   - „É¨„Éº„ÉàÂà∂ÈôêÔºà100„É™„ÇØ„Ç®„Çπ„Éà/ÊôÇÔºâ„Å´„Çà„ÇãDoSÊîªÊíÉÈò≤Ê≠¢
   - Á∑äÊÄ•ÂÅúÊ≠¢ÊâãÈ†ÜÊõ∏

8. **„Éá„Éº„Çø„Éó„É©„Ç§„Éê„Ç∑„Éº„ÉªGDPRÊ∫ñÊã†** üÜï
   - „Éó„É©„Ç§„Éê„Ç∑„Éº„Éù„É™„Ç∑„Éº„Å®„Éá„Éº„ÇøÂèñÊâ±„Ç¨„Ç§„Éâ„É©„Ç§„É≥
   - ‰øùÊåÅÊúüÈñìÔºà30Êó•ÔºâÂæå„ÅÆËá™Âãï„Éá„Éº„ÇøÂâäÈô§
   - GDPRÊ∫ñÊã†„ÅÆ„Éá„Éº„ÇøÂâäÈô§API
   - „É≠„Ç∞„ÅÆPIIÊ§úÂá∫„Éª„Éû„Çπ„Ç≠„É≥„Ç∞

### ÊäÄË°ì„Çπ„Çø„ÉÉ„ÇØ

- **„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ**: FastAPI, Python 3.11, SQLAlchemy 2.0, SQLite3
- **AI**: OpenAI API
- **„Éï„É≠„É≥„Éà„Ç®„É≥„Éâ**: Vanilla JavaScriptÔºàÂÜÖËîµÈùôÁöÑUIÔºâ
- **„Éï„Ç°„Ç§„É´Âá¶ÁêÜ**: openpyxl, pandas
- **„ÉÜ„Çπ„Éà**: pytest, pytest-asyncio, pytest-covÔºà87„ÉÜ„Çπ„Éà„ÄÅ100%ÂêàÊ†ºÁéáÔºâ

## „Ç§„É≥„Çπ„Éà„Éº„É´ÊñπÊ≥ï

### 1. „É™„Éù„Ç∏„Éà„É™„ÅÆ„ÇØ„É≠„Éº„É≥

```bash
git clone https://github.com/daishir0/ai-estimator2.git
cd ai-estimator2
```

### 2. PythonÁí∞Â¢É„ÅÆ„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó

```bash
# Python 3.11‰ª•‰∏ä„ÅÆÁí∞Â¢É„Çí„Ç¢„ÇØ„ÉÜ„Ç£„Éô„Éº„Éà
# conda„ÅÆ‰æãÔºö
# source /path/to/conda/bin/activate
# conda activate your-python-env

# backend„Éá„Ç£„É¨„ÇØ„Éà„É™„Å´ÁßªÂãï
cd backend
```

### 3. ‰æùÂ≠ò„Éë„ÉÉ„Ç±„Éº„Ç∏„ÅÆ„Ç§„É≥„Çπ„Éà„Éº„É´

```bash
pip install -r requirements.txt
```

### 4. Áí∞Â¢ÉÂ§âÊï∞„ÅÆË®≠ÂÆö

```bash
cp .env.sample .env
```

`.env`„Éï„Ç°„Ç§„É´„ÇíÁ∑®ÈõÜ„Åó„Å¶OpenAI API„Ç≠„Éº„ÇíË®≠ÂÆöÔºö

```bash
# OpenAI APIË®≠ÂÆö
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_MODEL=gpt-4o-mini

# „Éá„Éº„Çø„Éô„Éº„Çπ
DATABASE_URL=sqlite:///./app.db

# „Çµ„Éº„Éê„ÉºË®≠ÂÆö
CORS_ORIGINS=http://localhost:8000,https://estimator.path-finder.jp
API_V1_STR=/api/v1

# „Éï„Ç°„Ç§„É´„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ
UPLOAD_DIR=./uploads
MAX_UPLOAD_SIZE_MB=10

# Âçò‰æ°Ë®≠ÂÆö
UNIT_PRICE_PER_DAY=40000
DAILY_UNIT_COST_JPY=40000
DAILY_UNIT_COST_USD=500

# Ë®ÄË™ûË®≠ÂÆö
LANGUAGE=ja  # „Åæ„Åü„ÅØ 'en' „ÅßËã±Ë™û

# „Ç≥„Çπ„ÉàÁÆ°ÁêÜ
DAILY_COST_LIMIT=10.0      # OpenAI APIÊó•Ê¨°„Ç≥„Çπ„Éà‰∏äÈôêÔºàUSDÔºâ
MONTHLY_COST_LIMIT=200.0   # OpenAI APIÊúàÊ¨°„Ç≥„Çπ„Éà‰∏äÈôêÔºàUSDÔºâ

# „É¨„Éº„ÉàÂà∂Èôê
RATE_LIMIT_MAX_REQUESTS=100      # „Ç¶„Ç£„É≥„Éâ„Ç¶„ÅÇ„Åü„Çä„ÅÆÊúÄÂ§ß„É™„ÇØ„Ç®„Çπ„ÉàÊï∞
RATE_LIMIT_WINDOW_SECONDS=3600   # „É¨„Éº„ÉàÂà∂Èôê„Ç¶„Ç£„É≥„Éâ„Ç¶Ôºà1ÊôÇÈñìÔºâ

# „É¨„Ç∏„É™„Ç®„É≥„ÇπË®≠ÂÆö
OPENAI_TIMEOUT=30                    # OpenAI API„Çø„Ç§„É†„Ç¢„Ç¶„ÉàÔºàÁßíÔºâ
OPENAI_MAX_RETRIES=3                 # ÊúÄÂ§ß„É™„Éà„É©„Ç§ÂõûÊï∞
OPENAI_RETRY_INITIAL_DELAY=1.0       # ÂàùÂõû„É™„Éà„É©„Ç§ÈÅÖÂª∂ÔºàÁßíÔºâ
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5  # „Çµ„Éº„Ç≠„ÉÉ„Éà„Éñ„É¨„Éº„Ç´„ÉºÈñãÊîæ„Åæ„Åß„ÅÆÂ§±ÊïóÂõûÊï∞
MAX_CONCURRENT_ESTIMATES=5           # ÊúÄÂ§ß‰∏¶Ë°åË¶ãÁ©ç„ÇäÂá¶ÁêÜÊï∞

# „É≠„ÇÆ„É≥„Ç∞
LOG_LEVEL=INFO        # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_FILE=            # „É≠„Ç∞„Éï„Ç°„Ç§„É´„Éë„ÇπÔºàÁ©∫=„Ç≥„É≥„ÇΩ„Éº„É´„ÅÆ„ÅøÔºâ
MASK_PII=false       # „É≠„Ç∞„ÅÆPII„Éû„Çπ„Ç≠„É≥„Ç∞ÊúâÂäπÂåñ

# „Éó„É©„Ç§„Éê„Ç∑„ÉºË®≠ÂÆö
DATA_RETENTION_DAYS=30        # „Çø„Çπ„ÇØ„Éá„Éº„Çø‰øùÊåÅÊúüÈñìÔºàÊó•Êï∞Ôºâ
AUTO_CLEANUP_ENABLED=true     # Ëá™Âãï„Éá„Éº„Çø„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóÊúâÂäπÂåñ
PRIVACY_POLICY_VERSION=1.0    # „Éó„É©„Ç§„Éê„Ç∑„Éº„Éù„É™„Ç∑„Éº„Éê„Éº„Ç∏„Éß„É≥
```

### 5. „Éá„Éº„Çø„Éô„Éº„Çπ„ÅÆÂàùÊúüÂåñ

SQLite„Éá„Éº„Çø„Éô„Éº„Çπ„ÅØÂàùÂõûËµ∑ÂãïÊôÇ„Å´Ëá™ÂãïÁöÑ„Å´‰ΩúÊàê„Åï„Çå„Åæ„Åô„ÄÇËøΩÂä†„ÅÆË®≠ÂÆö„ÅØ‰∏çË¶Å„Åß„Åô„ÄÇ

### 6. „Çµ„Éº„Éê„Éº„ÅÆËµ∑Âãï

```bash
# ÈñãÁô∫„É¢„Éº„Éâ
uvicorn app.main:app --reload --host 127.0.0.1 --port 8000

# Êú¨Áï™„É¢„Éº„ÉâÔºàsystemd‰ΩøÁî®Ôºâ
sudo systemctl start estimator.service
```

### 7. „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Å∏„ÅÆ„Ç¢„ÇØ„Çª„Çπ

- Web UI: http://localhost:8000/ui
- API„Éâ„Ç≠„É•„É°„É≥„Éà: http://localhost:8000/docs
- Êú¨Áï™Áí∞Â¢ÉURL: https://estimator.path-finder.jp/

## ‰Ωø„ÅÑÊñπ

### Âü∫Êú¨ÁöÑ„Å™„ÉØ„Éº„ÇØ„Éï„É≠„Éº

1. **ÊàêÊûúÁâ©„ÅÆ„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ**
   - ÂÖ•ÂäõÊñπÂºè„ÇíÈÅ∏ÊäûÔºàExcel/CSV/Web„Éï„Ç©„Éº„É†Ôºâ
   - „Éï„Ç°„Ç§„É´„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åæ„Åü„ÅØÊâãÂãïÂÖ•Âäõ
   - ÂøÖË¶Å„Å´Âøú„Åò„Å¶„Ç∑„Çπ„ÉÜ„É†Ë¶Å‰ª∂„ÇíËøΩÂä†

2. **AIË≥™Âïè„Å∏„ÅÆÂõûÁ≠î**
   - „Ç∑„Çπ„ÉÜ„É†„Åå3„Å§„ÅÆÈñ¢ÈÄ£Ë≥™Âïè„ÇíÁîüÊàê
   - Ë≥™Âïè„Å´ÂõûÁ≠î„Åó„Å¶Ë¶ãÁ©ç„Çä„ÇíÁ≤æÁ∑ªÂåñ
   - ÂõûÁ≠î„ÇíÈÄÅ‰ø°„Åó„Å¶Ê¨°„Å∏ÈÄ≤„ÇÄ

3. **Ë¶ãÁ©ç„Çä„ÅÆÁ¢∫Ë™ç**
   - Ê†πÊã†‰ªò„Åç„ÅÆË©≥Á¥∞Ë¶ãÁ©ç„Çä„ÇíË°®Á§∫
   - Â∑•Êï∞ÂÜÖË®≥„ÇíÁ¢∫Ë™çÔºàË¶Å‰ª∂ÂÆöÁæ©„ÄÅË®≠Ë®à„ÄÅÂÆüË£Ö„ÄÅ„ÉÜ„Çπ„Éà„ÄÅ„Éâ„Ç≠„É•„É°„É≥„Éà‰ΩúÊàêÔºâ
   - Á®éËæº„ÅøÂêàË®àÈáëÈ°ç„ÇíÁ¢∫Ë™ç

4. **Ë¶ãÁ©ç„Çä„ÅÆË™øÊï¥Ôºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ**
   - Ë™øÊï¥„É™„ÇØ„Ç®„Çπ„Éà„ÇíÂÖ•ÂäõÔºö„Äå„ÅÇ„Å®30‰∏áÂÜÜ„Åª„Å©ÂÆâ„Åè„Åô„ÇãÊ°à„ÇíÊïô„Åà„Å¶„Äç
   - AI„ÅåÁîüÊàê„Åó„Åü3„Å§„ÅÆÊèêÊ°à„Ç´„Éº„Éâ„ÇíÁ¢∫Ë™ç
   - „Äå„Åì„ÅÆÊ°à„ÇíÈÅ©Áî®„Åô„Çã„Äç„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÈÅ∏Êäû„Åó„ÅüÊèêÊ°à„ÇíÈÅ©Áî®
   - ÊúÄÁµÇË¶ãÁ©ç„Çä„ÇíExcel„Éï„Ç°„Ç§„É´„Åß„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ

### API„Ç®„É≥„Éâ„Éù„Ç§„É≥„Éà

#### „Ç≥„Ç¢Ë¶ãÁ©ç„Çä„Ç®„É≥„Éâ„Éù„Ç§„É≥„Éà
- `POST /api/v1/tasks` - Êñ∞Ë¶èË¶ãÁ©ç„Çä„Çø„Çπ„ÇØ„ÅÆ‰ΩúÊàê
- `GET /api/v1/tasks/{task_id}/questions` - AIÁîüÊàêË≥™Âïè„ÅÆÂèñÂæó
- `POST /api/v1/tasks/{task_id}/answers` - ÂõûÁ≠îÈÄÅ‰ø°„Å®Ë¶ãÁ©ç„ÇäÁîüÊàê
- `GET /api/v1/tasks/{task_id}/result` - Ë¶ãÁ©ç„ÇäÁµêÊûú„ÅÆÂèñÂæó
- `POST /api/v1/tasks/{task_id}/chat` - AIÊèêÊ°à„Å´„Çà„ÇãË¶ãÁ©ç„ÇäË™øÊï¥
- `POST /api/v1/tasks/{task_id}/apply` - Ë™øÊï¥Âæå„ÅÆË¶ãÁ©ç„Çä„ÇíÈÅ©Áî®
- `GET /api/v1/tasks/{task_id}/download` - Excel„Éï„Ç°„Ç§„É´„ÅÆ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
- `DELETE /api/v1/tasks/{task_id}` - „Çø„Çπ„ÇØ„Éá„Éº„ÇøÂâäÈô§ÔºàGDPRÊ∫ñÊã†Ôºâ üÜï

#### Áõ£Ë¶ñ„ÉªÁÆ°ÁêÜËÄÖ„Ç®„É≥„Éâ„Éù„Ç§„É≥„Éà üÜï
- `GET /api/v1/metrics` - „Ç∑„Çπ„ÉÜ„É†„É°„Éà„É™„ÇØ„ÇπÂèñÂæóÔºàAPIÂëº„Å≥Âá∫„Åó„ÄÅ„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÄÅ„Ç®„É©„ÉºÔºâ
- `GET /api/v1/admin/costs` - OpenAI API„Ç≥„Çπ„ÉàÁä∂Ê≥ÅÂèñÂæó
- `GET /api/v1/admin/rate-limits` - „É¨„Éº„ÉàÂà∂ÈôêÁä∂Ê≥ÅÂèñÂæó
- `GET /api/v1/admin/metrics` - Á∑èÂêà„Ç∑„Çπ„ÉÜ„É†„É°„Éà„É™„ÇØ„ÇπÂèñÂæó
- `POST /api/v1/admin/reset-rate-limit/{client_id}` - „ÇØ„É©„Ç§„Ç¢„É≥„Éà„ÅÆ„É¨„Éº„ÉàÂà∂Èôê„É™„Çª„ÉÉ„Éà

#### „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£„Ç®„É≥„Éâ„Éù„Ç§„É≥„Éà
- `GET /api/v1/sample-input` - „Çµ„É≥„Éó„É´Excel„Éï„Ç°„Ç§„É´„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
- `GET /api/v1/sample-input-csv` - „Çµ„É≥„Éó„É´CSV„Éï„Ç°„Ç§„É´„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
- `GET /api/v1/translations` - UIÁøªË®≥„Éá„Éº„ÇøÂèñÂæóÔºài18nÂØæÂøúÔºâ

### „Çµ„É≥„Éó„É´ÂÖ•Âäõ„Éï„Ç°„Ç§„É´

- „Çµ„É≥„Éó„É´Excel: http://localhost:8000/api/v1/sample-input
- „Çµ„É≥„Éó„É´CSV: http://localhost:8000/api/v1/sample-input-csv

## Ê≥®ÊÑèÁÇπ

- AIÊ©üËÉΩ„Çí‰ΩøÁî®„Åô„Çã„Å´„ÅØOpenAI API„Ç≠„Éº„ÅåÂøÖË¶Å„Åß„Åô
- „Éá„Éï„Ç©„É´„Éà„ÅÆÂçò‰æ°„ÅØ1‰∫∫Êó•„ÅÇ„Åü„Çä40,000ÂÜÜ„Åß„ÅôÔºà.env„ÅßÂ§âÊõ¥ÂèØËÉΩÔºâ
- „Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Éï„Ç°„Ç§„É´„ÅÆÊúÄÂ§ß„Çµ„Ç§„Ç∫„ÅØ10MB„Åß„ÅôÔºàÂ§âÊõ¥ÂèØËÉΩÔºâ
- Excel„Éï„Ç°„Ç§„É´„Å´„ÅØ„ÄåÊàêÊûúÁâ©ÂêçÁß∞„Äç„ÄåË™¨Êòé„Äç„ÅÆÂàó„ÅåÂøÖË¶Å„Åß„Åô
- CSV„Éï„Ç°„Ç§„É´„ÅØUTF-8„Ç®„É≥„Ç≥„Éº„Éâ„Åß„ÅÇ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô
- ÊèêÊ°à„Ç≠„É£„ÉÉ„Ç∑„É•„ÅØ„ÇØ„É©„ÇπÂ§âÊï∞„Çí‰ΩøÁî®„Åó„Å¶ÂÖ®„Ç§„É≥„Çπ„Çø„É≥„ÇπÈñì„ÅßÂÖ±Êúâ„Åï„Çå„Åæ„Åô
- „Ç∑„Çπ„ÉÜ„É†„ÅØ„Ç≥„Çπ„ÉàÂäπÁéá„ÅÆËâØ„ÅÑgpt-4o-mini„Çí‰ΩøÁî®„Åó„Å¶„ÅÑ„Åæ„Åô
- Ë™øÊï¥È°ç„ÅØAI„ÅÆtarget_amount_change„Åß„ÅØ„Å™„Åè„ÄÅÂÆüÈöõ„ÅÆË¶ãÁ©ç„ÇäÂ∑ÆÂàÜ„ÇíË®àÁÆó„Åó„Å¶ÁÆóÂá∫„Åó„Åæ„Åô

## „Éâ„Ç≠„É•„É°„É≥„Éà

`docs/`„Éá„Ç£„É¨„ÇØ„Éà„É™„Å´ÂåÖÊã¨ÁöÑ„Å™„Éâ„Ç≠„É•„É°„É≥„Éà„ÅåÁî®ÊÑè„Åï„Çå„Å¶„ÅÑ„Åæ„ÅôÔºö

### „É¶„Éº„Ç∂„Éº„ÉªÈÅãÁî®ÊãÖÂΩìËÄÖÂêë„Åë

- **[„Éó„É≠„Ç∏„Çß„ÇØ„ÉàÊ¶ÇË¶Å](docs/PROJECT.md)** - „Ç∑„Çπ„ÉÜ„É†Ê¶ÇË¶Å„ÄÅ„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£Âõ≥„ÄÅÈñãÂßã„Ç¨„Ç§„ÉâÔºàÊó•Ëã±‰∏°Ë®ÄË™ûÔºâ
- **[„Éá„Éó„É≠„Ç§„É°„É≥„Éà„Ç¨„Ç§„Éâ](docs/deployment/DEPLOYMENT.md)** - Êú¨Áï™Áí∞Â¢É„Å∏„ÅÆÂÆåÂÖ®„Å™„Éá„Éó„É≠„Ç§ÊâãÈ†Ü
- **[ÈÅãÁî®ÊâãÈ†ÜÊõ∏](docs/operations/RUNBOOK.md)** - Êó•Ê¨°ÈÅãÁî®„ÄÅÁõ£Ë¶ñ„ÄÅ‰øùÂÆàÊâãÈ†Ü
- **[„Éà„É©„Éñ„É´„Ç∑„É•„Éº„ÉÜ„Ç£„É≥„Ç∞„Ç¨„Ç§„Éâ](docs/operations/TROUBLESHOOTING.md)** - „Çà„Åè„ÅÇ„ÇãÂïèÈ°å„Å®Ëß£Ê±∫ÊñπÊ≥ï„ÄÅ„É≠„Ç∞Á¢∫Ë™çÊñπÊ≥ï
- **[Á∑äÊÄ•ÂÅúÊ≠¢ÊâãÈ†ÜÊõ∏](docs/operations/EMERGENCY_SHUTDOWN.ja.md)** üÜï - „Ç≥„Çπ„ÉàË∂ÖÈÅé„Éª„Çª„Ç≠„É•„É™„ÉÜ„Ç£„Ç§„É≥„Ç∑„Éá„É≥„ÉàÁô∫ÁîüÊôÇ„ÅÆÁ∑äÊÄ•ÂØæÂøú
- **[Áõ£Ë¶ñË®àÁîª](docs/monitoring/MONITORING_PLAN.md)** üÜï - ÂåÖÊã¨ÁöÑ„Å™Áõ£Ë¶ñÊà¶Áï•„Å®„Ç¢„É©„Éº„ÉàË®≠ÂÆö

### ÈñãÁô∫ËÄÖÂêë„Åë

- **[ÈñãÁô∫ËÄÖ„Ç¨„Ç§„Éâ](docs/development/DEVELOPER_GUIDE.md)** - ÈñãÁô∫Áí∞Â¢É„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó„ÄÅ„Ç≥„Éº„Éá„Ç£„É≥„Ç∞Ë¶èÁ¥Ñ„ÄÅ„ÉÜ„Çπ„Éà
- **[API „É™„Éï„Ç°„É¨„É≥„Çπ](docs/development/API_REFERENCE.md)** - ÂÆåÂÖ®„Å™REST API„Éâ„Ç≠„É•„É°„É≥„Éà„Å®‰ΩøÁî®‰æã
- **[„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£„Éâ„Ç≠„É•„É°„É≥„Éà](docs/architecture/ARCHITECTURE.md)** - „Ç∑„Çπ„ÉÜ„É†„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£„ÄÅ„Éá„Éº„Çø„É¢„Éá„É´„ÄÅ„Ç∑„Éº„Ç±„É≥„ÇπÂõ≥

### „Çª„Ç≠„É•„É™„ÉÜ„Ç£„Éª„Éó„É©„Ç§„Éê„Ç∑„Éº„Éª„Ç≥„É≥„Éó„É©„Ç§„Ç¢„É≥„Çπ

- **[„Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÉÅ„Çß„ÉÉ„ÇØ„É™„Çπ„Éà](docs/security/SECURITY_CHECKLIST.md)** - „Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÅÆ„Éô„Çπ„Éà„Éó„É©„ÇØ„ÉÜ„Ç£„Çπ„Å®Ê§úË®º
- **[ÂÆâÂÖ®ÊÄß„Éù„É™„Ç∑„Éº](docs/safety/SAFETY_POLICY.md)** - LLM‰ΩøÁî®„Éù„É™„Ç∑„Éº„Å®„Éá„Éº„ÇøÂèñÊâ±„Ç¨„Ç§„Éâ„É©„Ç§„É≥
- **[„Éó„É©„Ç§„Éê„Ç∑„Éº„Éù„É™„Ç∑„Éº](docs/privacy/PRIVACY_POLICY.ja.md)** üÜï - „Éá„Éº„ÇøÂèéÈõÜ„ÄÅÂà©Áî®„ÄÅ‰øùÊåÅ„Å´Èñ¢„Åô„Çã„Éù„É™„Ç∑„Éº
- **[GDPR„ÉÅ„Çß„ÉÉ„ÇØ„É™„Çπ„Éà](docs/privacy/GDPR_CHECKLIST.ja.md)** üÜï - GDPRÊ∫ñÊã†„ÅÆÊ§úË®º„Å®Ë¶Å‰ª∂

### Ëã±Ë™ûÁâà„Éâ„Ç≠„É•„É°„É≥„Éà

„Åô„Åπ„Å¶„ÅÆ„Éâ„Ç≠„É•„É°„É≥„Éà„ÅØËã±Ë™ûÁâà„ÇÇÊèê‰æõ„Åï„Çå„Å¶„ÅÑ„Åæ„ÅôÔºàEnglish versionÔºâÔºö

- [Project Overview](docs/PROJECT.md) (Bilingual)
- [Deployment Guide](docs/deployment/DEPLOYMENT_EN.md)
- [Operations Runbook](docs/operations/RUNBOOK_EN.md)
- [Troubleshooting Guide](docs/operations/TROUBLESHOOTING_EN.md)
- [Developer Guide](docs/development/DEVELOPER_GUIDE_EN.md)
- [API Reference](docs/development/API_REFERENCE_EN.md)
- [Architecture Documentation](docs/architecture/ARCHITECTURE_EN.md)

## „É©„Ç§„Çª„É≥„Çπ
„Åì„ÅÆ„Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÅØMIT„É©„Ç§„Çª„É≥„Çπ„ÅÆ‰∏ã„Åß„É©„Ç§„Çª„É≥„Çπ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇË©≥Á¥∞„ÅØLICENSE„Éï„Ç°„Ç§„É´„ÇíÂèÇÁÖß„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
